<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>BamBanking Login | Projects</title>

    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;800&display=swap"
        rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />

    <!-- GLOBAL STYLES -->
    <link rel="stylesheet" th:href="@{/css/footer.css}" />
    <link rel="stylesheet" th:href="@{/css/style.css}" />
    <link rel="stylesheet" th:href="@{/css/nav.css}" />

    <!-- PAGE STYLES -->
    <link rel="stylesheet" th:href="@{/css/bambanking.css}" />
    <link rel="stylesheet" th:href="@{/css/bb-modal.css}" />
</head>

<body th:attr="data-error=${error},data-success=${success},data-open-signup=${openSignup}">

    <div id="cursor-bg" aria-hidden="true"></div>

    <div class="window">
        <!-- Title Bar -->
        <div class="title-bar">
            <div class="dots">
                <span class="red"></span><span class="yellow"></span><span class="green"></span>
            </div>

            <span class="filename">BankingApp</span>

            <div class="tb-right">
                <a href="https://amboyose.onrender.com/" class="chip-link">
                    <button class="chip chip-back" type="button">
                        <i class="fa-solid fa-house"></i>
                        <span style="font-size: small;">Home</span>
                    </button>
                </a>
            </div>
        </div>

        <!-- LOGIN / SIGNUP CARD FLIP -->
        <div class="login-wrapper">
            <div class="login-flip-scene">
                <div class="login-flip-inner" id="authFlip">

                    <!-- FRONT: LOGIN -->
                    <div class="login-flip-face front">
                        <div class="login-card">

                            <div class="login-tabs">
                                <button class="login-tab active" id="tabLogin" type="button">
                                    <i class="fa-solid fa-right-to-bracket"></i> Login
                                </button>
                                <button class="login-tab" id="tabSignup" type="button">
                                    <i class="fa-regular fa-id-card"></i> Sign up
                                </button>
                            </div>

                            <h1 class="login-title">
                                Login() <span class="login-sub">// BamBanking demo</span>
                            </h1>

                            <!-- LOGIN FORM -->
                            <form th:action="@{/bambanking/login}" method="post" id="bb-login-form" novalidate
                                onsubmit="return validateLogin(event)">
                                <div class="form-row form-row-inline">
                                    <label for="username">username</label>
                                    <input type="text" id="username" name="username"
                                        placeholder="use your valid email" />
                                </div>

                                <div class="form-row form-row-inline">
                                    <label for="pin">pin</label>
                                    <input type="password" id="pin" name="pin" minlength="4" maxlength="4"
                                        inputmode="numeric" pattern="\d{4}" placeholder="input 4 digits" />
                                </div>

                                <div class="login-actions">
                                    <button type="submit" class="btn-login">
                                        Login
                                    </button>
                                </div>
                                <br>

                                <div class="forgot-pin-row">
                                    <a href="/bambanking/forgot-pin" class="forgot-pin-link">Forgot PIN?</a>
                                </div>
                            </form>

                        </div>
                    </div>

                    <!-- BACK: SIGNUP -->
                    <div class="login-flip-face back">
                        <div class="login-card">

                            <div class="login-tabs">
                                <button class="login-tab" id="tabLoginBack" type="button">
                                    <i class="fa-solid fa-right-to-bracket"></i> Login
                                </button>
                                <button class="login-tab active" id="tabSignupBack" type="button">
                                    <i class="fa-regular fa-id-card"></i> Sign up
                                </button>
                            </div>

                            <h1 class="login-title">
                                Signup() <span class="login-sub">// OTP via Email</span>
                            </h1>

                            <!-- SIGNUP FORM -->
                            <form th:action="@{/bambanking/signup}" method="post" id="signupForm" novalidate>

                                <!-- First + Last name row (2 columns) -->
                                <div class="login-field login-field-row">
                                    <div class="field-half">
                                        <label for="firstName">First Name</label>
                                        <input type="text" id="firstName" name="firstName" placeholder="Anna"
                                            required />
                                    </div>

                                    <div class="field-half">
                                        <label for="lastName">Last Name</label>
                                        <input type="text" id="lastName" name="lastName" placeholder="Boyose"
                                            required />
                                    </div>
                                </div>

                                <!-- Optional: full name for JS only (backend uses firstName/lastName) -->
                                <input type="hidden" id="fullName" name="fullName" />

                                <div class="login-field">
                                    <label for="email">email</label>
                                    <input type="email" id="email" name="email" placeholder="bamby.dev@gmail.com"
                                        required title="Please enter a valid email like name@example.com" />
                                </div>

                                <div class="login-field">
                                    <label for="signup-pin">choose pin</label>
                                    <input type="password" id="signup-pin" name="pin" maxlength="4" inputmode="numeric"
                                        pattern="\d{4}" placeholder="****" required />
                                </div>

                                <div class="login-actions">
                                    <button type="submit" class="btn-signup">
                                        Create Demo Account
                                    </button>
                                </div>
                            </form>

                        </div>
                    </div>

                </div>
            </div>
        </div>

    </div>

    <!-- FOOTER -->
    <footer class="site-footer">
        <p>© 2025 <strong>BAMBY</strong> | Designed &amp; Coded with ❤️</p>
        <p class="links">
            <a href="/index.html">About</a> •
            <a href="/portfolio.html">Portfolio</a> •
            <a href="/resume.html">Resume</a> •
            <a href="/contact.html">Contact</a>
        </p>
    </footer>

    <!-- ERROR MODAL (aligned with new bambanking-auth.js) -->
    <div id="bb-error-modal" class="bank-modal">
        <div class="bank-modal-box">
            <h2 class="bank-modal-title bb-error-title">Notice</h2>
            <p class="bank-modal-message bb-error-message">Message.</p>
            <button type="button" class="bank-modal-close" id="bb-error-ok">OK</button>
        </div>
    </div>

    <!-- JS -->
    <script th:src="@{/js/script.js}"></script>
    <script th:src="@{/js/nav.js}" defer></script>
    <script th:src="@{/js/bambanking-auth.js}" defer></script>

    <script>
        // BamBanking warm-up helper (uses #bb-warmup)
        window.BamBankingColdStart = (function () {
            const overlay = document.getElementById("bb-warmup");
            if (!overlay) {
                return { show() { }, hide() { }, ready() { } };
            }

            const dismissBtn = document.getElementById("bb-warmup-dismiss");
            const statusText = overlay.querySelector(".bb-warmup-status-text");
            const icon = overlay.querySelector(".bb-warmup-icon");
            const progressFill = overlay.querySelector("#bbProgressFill");
            const progressPctEl = overlay.querySelector("#bbProgressPct");
            const progressLabel = overlay.querySelector("#bbProgressLabel");

            // Progress phases: drives % bar + status messages
            const phases = [
                { pct: 10, label: "Connecting to BamBanking API…" },
                { pct: 35, label: "Spinning up Spring Boot context…" },
                { pct: 60, label: "Checking MongoDB Atlas connection…" },
                { pct: 85, label: "Preparing demo accounts & balances…" },
                { pct: 95, label: "Rendering BamBanking dashboard shell…" }
            ];

            let phaseIndex = 0;
            let phaseTimer = null;

            function applyPhase(phase) {
                if (progressFill) {
                    progressFill.style.width = phase.pct + "%";
                }
                if (progressPctEl) {
                    progressPctEl.textContent = phase.pct + "%";
                }
                if (statusText) {
                    statusText.textContent = phase.label;
                }
                if (progressLabel) {
                    progressLabel.textContent = phase.label;
                }
            }

            function startPhases() {
                if (!phases.length) return;
                phaseIndex = 0;
                applyPhase(phases[phaseIndex]);

                phaseTimer = setInterval(() => {
                    phaseIndex++;
                    if (phaseIndex >= phases.length) {
                        clearInterval(phaseTimer);
                        phaseTimer = null;
                        return;
                    }
                    applyPhase(phases[phaseIndex]);
                }, 2000);
            }

            function stopPhases() {
                if (phaseTimer) {
                    clearInterval(phaseTimer);
                    phaseTimer = null;
                }
            }

            function show() {
                overlay.classList.add("show");
                startPhases();
            }

            function hide() {
                stopPhases();
                overlay.classList.remove("show", "ready");
            }

            function ready() {
                // Call this after your first successful API hit
                overlay.classList.add("ready");
                stopPhases();

                // Lock progress at 100%
                if (progressFill) {
                    progressFill.style.width = "100%";
                }
                if (progressPctEl) {
                    progressPctEl.textContent = "100%";
                }

                const doneMsg = "Server is awake. Loading your account…";
                if (statusText) {
                    statusText.textContent = doneMsg;
                }
                if (progressLabel) {
                    progressLabel.textContent = doneMsg;
                }

                if (icon) {
                    icon.classList.remove("fa-circle-notch", "fa-spin");
                    icon.classList.add("fa-circle-check");
                }

                setTimeout(hide, 900); // let the green flash play
            }

            if (dismissBtn) {
                dismissBtn.addEventListener("click", hide);
            }

            // Auto-show when page finishes loading (so it runs on localhost too)
            window.addEventListener("load", show);

            // Safety: auto-hide after 45s in worst case
            setTimeout(hide, 45000);

            return { show, hide, ready };
        })();
    </script>


    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const overlay = document.getElementById("bb-warmup");
            const typingEl = document.getElementById("bbTyping");
            const sections = document.querySelectorAll(".bb-section");

            if (!overlay || !typingEl || sections.length === 0) return;

            let started = false;

            function startAnimations() {
                if (started) return;
                started = true;

                // ---- slower, more visible typing effect ----
                const text = "▶ Loading BamBanking services";
                let i = 0;
                function typeWriter() {
                    if (i < text.length) {
                        typingEl.textContent += text.charAt(i);
                        i++;
                        // 100 ms per character so the user really sees it
                        setTimeout(typeWriter, 100);
                    }
                }

                // ... (rest of revealNext etc stays the same)
            }


            // ---- reveal sections one by one ----
            let step = 0;
            function revealNext() {
                if (step < sections.length) {
                    sections[step].classList.add("active");
                    step++;
                    // slightly slower so the highlight is noticeable
                    setTimeout(revealNext, 900);
                }
            }

            // start both after a short delay so the dialog is fully visible
            setTimeout(() => {
                typeWriter();
                setTimeout(revealNext, 700);
            }, 500);
        }

            // watch for the overlay becoming visible (class "show")
            const observer = new MutationObserver(() => {
            if (overlay.classList.contains("show")) {
                startAnimations();
                observer.disconnect();
            }
        });

        observer.observe(overlay, { attributes: true });

        // if already visible for some reason, start immediately
        if (overlay.classList.contains("show")) {
            startAnimations();
            observer.disconnect();
        }
        });
    </script>


</body>

</html>
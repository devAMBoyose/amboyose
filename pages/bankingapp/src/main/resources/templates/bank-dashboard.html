<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>BamBanking – Dashboard</title>

    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;800&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />

    <!-- STATIC CSS (Spring Boot serving from /static/css/) -->
    <link rel="stylesheet" href="/css/footer.css" th:href="@{/css/footer.css}" />
    <link rel="stylesheet" href="/css/style.css" th:href="@{/css/style.css}" />
    <link rel="stylesheet" href="/css/nav.css" th:href="@{/css/nav.css}" />
    <link rel="stylesheet" href="/css/dashboard.css" th:href="@{/css/dashboard.css}" />
    <link rel="stylesheet" href="/css/quickactions.css" th:href="@{/css/quickactions.css}" />
    <link rel="stylesheet" href="/css/bb-theme-toggle.css" th:href="@{/css/bb-theme-toggle.css}" />
    <link rel="stylesheet" href="/css/bb-modal.css" th:href="@{/css/bb-modal.css}" />
</head>

<body>
    <div id="cursor-bg" aria-hidden="true"></div>

    <div class="window">
        <div class="title-bar">
            <div class="dots" aria-hidden="true">
                <span class="red"></span><span class="yellow"></span><span class="green"></span>
            </div>
            <span class="filename">Bam Banking Dashboard</span>
            <div class="tb-right">
                <a th:href="@{/bambanking/logout}" class="chip-link">
                    <button class="chip chip-logout">
                        <i class="fa-solid fa-arrow-right-from-bracket"></i>
                        <span>Logout</span>
                    </button>
                </a>
            </div>
        </div>

        <!-- MAIN DASHBOARD -->
        <div class="bb-dashboard">

            <!-- LEFT PANEL -->
            <div class="bb-tiles-panel">

                <!-- Check Balance -->
                <form th:action="@{/bambanking/check-balance}" method="post" class="bb-tile">
                    <div>
                        <h2>Check Balance</h2>
                        <div class="bb-tile-sub"></div>
                    </div>
                    <button type="submit">
                        <i class="fa-solid fa-magnifying-glass-dollar"></i> Check
                    </button>
                </form>

                <!-- Deposit -->
                <form th:action="@{/bambanking/deposit}" method="post" class="bb-tile">
                    <div>
                        <h2>Deposit Cash</h2>
                        <div class="bb-tile-sub"></div>
                    </div>
                    <div>
                        <input type="number" step="0.01" name="amount" placeholder="Amount" required />
                        <button type="submit">
                            <i class="fa-solid fa-circle-arrow-down"></i> Deposit
                        </button>
                    </div>
                </form>

                <!-- Withdraw -->
                <form th:action="@{/bambanking/withdraw}" method="post" class="bb-tile">
                    <div>
                        <h2>Withdraw Cash</h2>
                        <div class="bb-tile-sub"></div>
                    </div>
                    <div>
                        <input type="number" step="0.01" name="amount" placeholder="Amount" required />
                        <button type="submit">
                            <i class="fa-solid fa-circle-arrow-up"></i> Withdraw
                        </button>
                    </div>
                </form>

                <!-- Transfer -->
                <form th:action="@{/bambanking/transfer}" method="post" class="bb-tile">
                    <div>
                        <h2>Transfer Funds</h2>
                        <div class="bb-tile-sub"></div>
                    </div>
                    <div>
                        <input type="text" name="toUser" placeholder="To username" required />
                        <input type="number" step="0.01" name="amount" placeholder="Amount" required />
                        <button type="submit">
                            <i class="fa-solid fa-right-left"></i> Transfer
                        </button>
                    </div>
                </form>

                <!-- QUICK ACTIONS -->
                <!-- (unchanged) -->
                <!-- ... whole quick actions section same as your original ... -->

                <!-- HELP -->
                <a th:href="@{/bambanking/help}" class="bb-tile app-transaction tile-link">
                    <div>
                        <h2>App Transaction / Help</h2>
                        <div class="bb-tile-sub">via Menu</div>
                    </div>
                    <div class="bb-tile-sub">Learn how BamBanking works.</div>
                </a>

            </div>

            <!-- RIGHT PANEL -->
            <div class="bb-main-panel">
                <h2>Welcome to BAMBY Banking App</h2>

                <div class="bb-main-meta">
                    <!-- FIX: use account.username -->
                    <span>Welcome, <strong th:text="${account.username}">User</strong></span>
                    <span>Current balance: <strong>₱<span th:text="${balance}">0.00</span></strong></span>
                </div>

                <!-- THEME TOGGLE -->
                <!-- (unchanged) -->

                <div class="bb-main-content">

                    <!-- TOP WIDGET GRID -->
                    <!-- (balance card + virtual card + FX widget unchanged) -->

                    <!-- RECENT TRANSACTIONS -->
                    <!-- FIX: use recentTx instead of transactions -->
                    <div class="bb-transactions-card" th:if="${recentTx != null}">
                        <div class="bb-transactions-header">
                            <div>Recent Transactions</div>
                            <span th:text="'Last ' + ${recentTx.size()} + ' records'"></span>
                        </div>

                        <div class="bb-transactions-table-wrapper">
                            <table class="bb-transactions-table">
                                <thead>
                                    <tr>
                                        <th>DATE</th>
                                        <th>TYPE</th>
                                        <th>METHOD</th>
                                        <th>AMOUNT</th>
                                        <th>BALANCE</th>
                                        <th>REFERENCE</th>
                                        <th>STATUS</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="tx : ${recentTx}">
                                        <td th:text="${#temporals.format(tx.timestamp, 'yyyy-MM-dd HH:mm')}">
                                            2025-01-01
                                        </td>
                                        <td th:text="${tx.type}">Deposit</td>
                                        <td th:text="${tx.method}">APP</td>

                                        <td>
                                            <span
                                                th:classappend="${tx.type == 'Deposit'} ? ' bb-tx-amount-credit' : ' bb-tx-amount-debit'"
                                                th:text="${tx.type == 'Deposit' ? '+' : '-'} + '₱' + ${tx.amount}">
                                                +₱1,000.00
                                            </span>
                                        </td>

                                        <td th:text="'₱' + ${tx.balanceAfter}">₱0.00</td>
                                        <td th:text="${tx.reference}">BB-00000</td>

                                        <td>
                                            <span class="bb-tx-status"
                                                th:classappend="${tx.status == 'OK'} ? ' ok' : (${tx.status == 'PENDING'} ? ' pending' : ' failed')"
                                                th:text="${tx.status}">
                                                OK
                                            </span>
                                        </td>
                                    </tr>

                                    <tr th:if="${#lists.isEmpty(recentTx)}">
                                        <td colspan="7">No transactions yet.</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                </div><!-- bb-main-content -->

            </div><!-- right panel -->

        </div><!-- dashboard -->

    </div><!-- window -->

    <footer class="site-footer">
        <p>© 2025 <strong>BAMBY Banking App with Spring Boot</strong> | Designed & Coded with ❤️</p>
    </footer>

    <!-- QUICK ACTIONS MODAL -->
    <!-- FIX in modal account line only -->
    <div class="bb-modal" id="bbQaModal">
        <div class="bb-modal-backdrop" onclick="closeQaModal()"></div>

        <div class="bb-modal-dialog">
            <div class="bb-modal-header">
                <h3 id="bbQaModalTitle">Quick action</h3>
                <button type="button" class="bb-modal-close" onclick="closeQaModal()">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>

            <div class="bb-modal-body">

                <!-- ACCOUNT INFO -->
                <div class="bb-modal-section" data-action="account">
                    <p>Account: <strong th:text="${account.username}">user</strong></p>
                    <p>Current balance: <strong>₱<span th:text="${balance}">0.00</span></strong></p>
                    <form th:action="@{/bambanking/check-balance}" method="post">
                        <button type="submit" class="bb-modal-btn">
                            <i class="fa-solid fa-magnifying-glass-dollar"></i>
                            Check balance now
                        </button>
                    </form>
                </div>

                <!-- other modal sections unchanged... -->

            </div>
        </div>
    </div>

    <!-- SCRIPTS -->
    <script src="/js/script.js" th:src="@{/js/script.js}"></script>
    <script src="/js/nav.js" defer th:src="@{/js/nav.js}"></script>
    <script src="/js/dashboard.js" defer th:src="@{/js/dashboard.js}"></script>
    <script src="/js/bb-theme-toggle.js" defer th:src="@{/js/bb-theme-toggle.js}"></script>

    <!-- MODAL JS (unchanged) -->
</body>

</html>